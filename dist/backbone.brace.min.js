/*! 
 *  Backbone Brace - 2013-05-10 
 *  Copyright 2013 Atlassian Software Systems Pty Ltd
 *  Licensed under the Apache License, Version 2.0
 */
(function(){function t(t){return v.isArray(t)?v.reduce(t,function(t,e){return t[e]=null,t},{}):t}function e(t,i){if(!t||null==i)return i;if(t===String&&v.isString(i))return i;if(t===Number&&v.isNumber(i))return i;if(t===Boolean&&v.isBoolean(i))return i;if("string"==typeof t||t instanceof String){if(typeof i!=""+t)throw"The typeof "+i+" is "+typeof i+" but expected it to be "+t;return i}if(v.isArray(t)||t===Array){if(!r(i))throw"Array type expected, but nonnull, non-Array value provided.";return t!==Array&&t[0]?v.map(i,v.bind(e,null,t[0])):i}if("function"!=typeof t)throw"Invalid expected type "+t+". Should be falsy, String, Array, Backbone.Collection constructor, or function.";return i instanceof t?i:n(t)?new t(e([t.model],i)):new t(i)}function n(t,e){return t&&(t.__super__ instanceof(e||m.Collection)||t.__super__===(e||m.Collection).prototype||t===(e||m.Collection))}function r(t){return v.has(t,"length")&&!(t instanceof String||v.has({string:1,"function":1},typeof t)||t instanceof m.Collection)}function i(t,e){var n={};return v.each(t,function(t,r){if(e[r]&&!o(t,e[r])){if(!t||o(e[r],t))return;throw r+" has conflicted type descriptors."}n[r]=t}),n}function o(t,e){return e&&e!==t?t&&"string"!=typeof t?t instanceof Array?e===Array||e instanceof Array&&o(t[0],e[0]):"function"!=typeof e?!1:n(e)?n(t,e):t.prototype instanceof e:!1:!0}function a(t){return v.isObject(t)?v.reduce(t,function(t,e,n){return e&&v.isFunction(e.toJSON)?t[n]=e.toJSON():v.isArray(e)&&(t[n]=v.map(e,function(t){return t&&v.isFunction(t.toJSON)?t.toJSON():t})),t},t):t}function s(t){return function(){var e=t.call(this);return a(e)}}function u(e){return function n(r,i){var o,a,u=v.extend({},r);return r&&r.mixins&&(a=r.mixins,delete u.mixins),o=e.call(this,u,i),this.prototype.namedEvents&&l.Mixins.applyMixin(o,{namedEvents:this.prototype.namedEvents}),this.prototype.namedAttributes&&l.Mixins.applyMixin(o,{namedAttributes:this.prototype.namedAttributes}),a&&v.each(r.mixins,function(t){l.Mixins.applyMixin(o,t)}),o.prototype.namedEvents&&l.Mixins.applyMixin(o,l.EventsMixinCreator.create(o.prototype.namedEvents)),o.prototype.namedAttributes&&(o.prototype.namedAttributes=t(o.prototype.namedAttributes),l.Mixins.applyMixin(o,l.AttributesMixinCreator.create(o.prototype.namedAttributes))),o.prototype.toJSON&&(o.prototype.toJSON=s(o.prototype.toJSON)),o.extend=n,o}}function c(t,n){var r=t.prototype,i=n.prototype,o=r.set;i.set=function(t,n,r){var i,a=this.namedAttributes;if(!a||null==t)return o.apply(this,arguments);v.isObject(t)?(i=v.clone(t),r=n):(i={},i[t]=n);for(var s in i)if(v.has(i,s)){if(!v.has(a,s))throw"Attribute '"+s+"' does not exist";i[s]=e(a[s],i[s])}return o.call(this,i,r)};var a=r.get;i.get=function(t){if(this.namedAttributes&&!v.has(this.namedAttributes,t))throw"Attribute '"+t+"' does not exist";return a.apply(this,arguments)}}function p(t,e){var n=t.prototype,r=e.prototype,i=n.parse;r.parse=function(t,e){return v.pick(i(t,e),Object.keys(this.namedAttributes))}}function f(t){var e=t.extend(),n=t.extend;return e.extend=u(n),e}function d(t){var e=f(t);return c(t,e),p(t,e),e}var l,y=this,h=y.Brace;l="undefined"!=typeof exports?exports:y.Brace={},l.noConflict=function(){return y.Brace=h,this};var v=y._;v||"undefined"==typeof require||(v=require("underscore"));var m=y.Backbone;m||"undefined"==typeof require||(m=require("backbone")),l.Mixins={createMethodName:function(t,e){return t+e.charAt(0).toUpperCase()+e.substr(1)},applyMixin:function(e,n){v.forEach(v.keys(n),function(r){var o=e.prototype;if("initialize"===r){var a=o.initialize;return o.initialize=function(){a&&a.apply(this,arguments),n.initialize.apply(this,arguments)},void 0}if("validate"===r){var s=o.validate;return o.validate=function(){if(s){var t=s.apply(this,arguments);if(t)return t}return n.validate.apply(this,arguments)},void 0}if("defaults"!==r){if("namedAttributes"===r){var u=t(o.namedAttributes)||{},c=t(n[r]);return o.namedAttributes=v.extend(u,i(c,u)),void 0}if("namedEvents"===r){if(!v.isArray(n[r]))throw"Expects events member on mixin to be an array";return o.namedEvents||(o.namedEvents=[]),o.namedEvents=v.uniq(o.namedEvents.concat(n[r])),void 0}if(o.hasOwnProperty(r))throw"Mixin error: class already has property '"+r+"' defined";o[r]=n[r]}else{var p=o.defaults||(o.defaults={}),f=n[r];for(var d in f){if(p.hasOwnProperty(d))throw"Mixin error: class already has default '"+d+"' defined";p[d]=f[d]}}},this)}},l.AttributesMixinCreator={create:function(t){var e={};return t||(t={}),v.has(t,"id")||(t.id=null),v.each(t,function(t,n){var r=l.Mixins.createMethodName("set",n);e[r]=function(t,e){return this.set(n,t,e)};var i=l.Mixins.createMethodName("get",n);e[i]=function(){return this.get(n)}}),e},ensureType:e},l.EventsMixinCreator={create:function(t){var e={},n=function(t){var n=l.Mixins.createMethodName("on",t);e[n]=function(){return this.on.apply(this,[t].concat(v.toArray(arguments)))};var r=l.Mixins.createMethodName("trigger",t);e[r]=function(){return this.trigger.apply(this,[t].concat(v.toArray(arguments)))}};return v.each(t,v.bind(n,this)),e}},l.Model=d(m.Model),l.Collection=f(m.Collection),l.View=f(m.View),l.Router=f(m.Router)})();