//     Backbone Brace - 2012/10/7
//     Copyright 2012 Atlassian Software Systems Pty Ltd
//     Licensed under the Apache License, Version 2.0
(function(){function i(e){return function r(i,s){var o,u=n.extend({},i),a;return i&&i.mixins&&(a=i.mixins,delete u.mixins),o=e.call(this,u,s),this.prototype.namedEvents&&t.Mixins.applyMixin(o,{namedEvents:this.prototype.namedEvents}),this.prototype.namedAttributes&&t.Mixins.applyMixin(o,{namedAttributes:this.prototype.namedAttributes}),a&&n.each(i.mixins,function(e){t.Mixins.applyMixin(o,e)}),o.prototype.namedEvents&&t.Mixins.applyMixin(o,t.EventsMixinCreator.create(o.prototype.namedEvents)),o.prototype.namedAttributes&&t.Mixins.applyMixin(o,t.AttributesMixinCreator.create(o.prototype.namedAttributes)),o.extend=r,o}}function s(e,t){var r=e.prototype,i=t.prototype,s=r.set;i.set=function(e,t,r){var i,o=this.namedAttributes;if(o){n.isObject(e)||e==null?i=e:(i={},i[e]=t);for(var u in i)if(n.indexOf(o,u)<0)throw"Attribute '"+u+"' does not exist"}return s.apply(this,arguments)};var o=r.get;i.get=function(e){if(this.namedAttributes&&n.indexOf(this.namedAttributes,e)<0)throw"Attribute '"+e+"' does not exist";return o.apply(this,arguments)}}function o(e){var t=e.extend(),n=e.extend;return t.extend=i(n),t}function u(e){var t=o(e);return s(e,t),t}var e=this,t;typeof exports!="undefined"?t=exports:t=e.Brace={};var n=e._;!n&&typeof require!="undefined"&&(n=require("underscore"));var r=e.Backbone;!r&&typeof require!="undefined"&&(r=require("backbone")),t.Mixins={createMethodName:function(e,t){return e+t.charAt(0).toUpperCase()+t.substr(1)},applyMixin:function(e,t){n.forEach(n.keys(t),function(r){var i=e.prototype;if("initialize"===r){var s=i.initialize;i.initialize=function(){t.initialize.apply(this,arguments),s&&s.apply(this,arguments)};return}if("validate"===r){var o=i.validate;i.validate=function(){var e=t.validate.apply(this,arguments);if(e)return e;if(o)return o.apply(this,arguments)};return}if("defaults"===r){var u=i.defaults||(i.defaults={}),a=t[r];for(var f in a){if(u.hasOwnProperty(f))throw"Mixin error: class already has default '"+f+"' defined";u[f]=a[f]}return}if("namedAttributes"===r){if(!n.isArray(t[r]))throw"Expects namedAttributes member on mixin to be an array";i.namedAttributes||(i.namedAttributes=[]),i.namedAttributes=n.uniq(i.namedAttributes.concat(t[r]));return}if("namedEvents"===r){if(!n.isArray(t[r]))throw"Expects events member on mixin to be an array";i.namedEvents||(i.namedEvents=[]),i.namedEvents=n.uniq(i.namedEvents.concat(t[r]));return}if(i.hasOwnProperty(r))throw"Mixin error: class already has property '"+r+"' defined";i[r]=t[r]},this)}},t.AttributesMixinCreator={create:function(e){var r={};return n.indexOf(e,"id")===-1&&e.unshift("id"),n.each(e,function(e){var n=t.Mixins.createMethodName("set",e);r[n]=function(t,n){var r={};return r[e]=t,this.set(r,n),this};var i=t.Mixins.createMethodName("get",e);r[i]=function(){return this.get(e)}}),r}},t.EventsMixinCreator={create:function(e){var r={},i=function(e){var i=t.Mixins.createMethodName("on",e);r[i]=function(){return this.on.apply(this,[e].concat(n.toArray(arguments)))};var s=t.Mixins.createMethodName("trigger",e);r[s]=function(){return this.trigger.apply(this,[e].concat(n.toArray(arguments)))}};return n.each(e,n.bind(i,this)),r}},t.Model=u(r.Model),t.Collection=o(r.Collection),t.View=o(r.View),t.Router=o(r.Router)})();